<h1> Test <h1>


# physical_book1 = PhysicalBook.new(price: rand(8..14), available: "yes", book: book20, bookstore: bookstore1, condition: "New")
# physical_book1.save!
# puts "generated physical book"

# physical_book2 = PhysicalBook.new(price: rand(3..8), available: "yes", book: book20, bookstore: bookstore2, condition: "Used")
# physical_book2.save!
# puts "generated physical book"

# physical_book3 = PhysicalBook.new(price: rand(8..14), available: "yes", book: book20, bookstore: bookstore3, condition: "New")
# physical_book3.save!
# puts "generated physical book"

# physical_book4 = PhysicalBook.new(price: rand(3..8), available: "yes", book: book5, bookstore: bookstore1, condition: "Used")
# physical_book4.save!
# puts "generated physical book"

# physical_book5 = PhysicalBook.new(price: rand(8..14), available: "yes", book: book5, bookstore: bookstore2, condition: "New")
# physical_book5.save!
# puts "generated physical book"

# physical_book6 = PhysicalBook.new(price: rand(3..8), available: "yes", book: book1, bookstore: bookstore1, condition: "Used")
# physical_book6.save!
# puts "generated physical book"

# physical_book7 = PhysicalBook.new(price: rand(8..14), available: "yes", book: book5, bookstore: bookstore3, condition: "New")
# physical_book7.save!
# puts "generated physical book"

# physical_book8 = PhysicalBook.new(price: rand(3..8), available: false, book: book5, bookstore: bookstore4, condition: "Used")
# physical_book8.save!
# puts "generated physical book"

# physical_book9 = PhysicalBook.new(price: rand(8..14), available: "yes", book: book1, bookstore: bookstore4, condition: "New")
# physical_book9.save!
# puts "generated physical book"

# physical_book10 = PhysicalBook.new(price: rand(3..8), available: "yes", book: book6, bookstore: bookstore1, condition: "Used")
# physical_book10.save!
# puts "generated physical book"

# physical_book11 = PhysicalBook.new(price: rand(8..14), available: "yes", book: book6, bookstore: bookstore2, condition: "New")
# physical_book11.save!
# puts "generated physical book"

# physical_book12 = PhysicalBook.new(price: rand(3..8), available: "yes", book: book6, bookstore: bookstore3, condition: "Used")
# physical_book12.save!
# puts "generated physical book"

# physical_book13 = PhysicalBook.new(price: rand(8..14), available: "yes", book: book6, bookstore: bookstore4, condition: "New")
# physical_book13.save!
# puts "generated physical book"

# physical_book14 = PhysicalBook.new(price: rand(3..8), available: "yes", book: book2, bookstore: bookstore3, condition: "Used")
# physical_book14.save!
# puts "generated physical book"

# physical_book15 = PhysicalBook.new(price: rand(8..14), available: "yes", book: book2, bookstore: bookstore5, condition: "New")
# physical_book15.save!
# puts "generated physical book"

# # work on it!
# physical_book16 = PhysicalBook.new(price: rand(3..8), available: "yes", book: book3, bookstore: bookstore6, condition: "Used")
# physical_book16.save!
# puts "generated physical book"

# physical_book17 = PhysicalBook.new(price: rand(8..14), available: "yes", book: book4, bookstore: bookstore3, condition: "New")
# physical_book17.save!
# puts "generated physical book"

# physical_book18 = PhysicalBook.new(price: rand(3..8), available: "yes", book: book7, bookstore: bookstore5, condition: "Used")
# physical_book18.save!
# puts "generated physical book"

# physical_book19 = PhysicalBook.new(price: rand(8..14), available: "yes", book: book7, bookstore: bookstore6, condition: "New")
# physical_book19.save!
# puts "generated physical book"

# physical_book20 = PhysicalBook.new(price: rand(3..8), available: "yes", book: book8, bookstore: bookstore4, condition: "Used")
# physical_book20.save!
# puts "generated physical book"

# physical_book21 = PhysicalBook.new(price: rand(8..14), available: "yes", book: book8, bookstore: bookstore1, condition: "New")
# physical_book21.save!
# puts "generated physical book"

# physical_book22 = PhysicalBook.new(price: rand(3..8), available: "yes", book: book9, bookstore: bookstore6, condition: "Used")
# physical_book22.save!
# puts "generated physical book"

# physical_book23 = PhysicalBook.new(price: rand(8..14), available: "yes", book: book9, bookstore: bookstore1, condition: "New")
# physical_book23.save!
# puts "generated physical book"

# physical_book24 = PhysicalBook.new(price: rand(3..8), available: "yes", book: book9, bookstore: bookstore4, condition: "Used")
# physical_book24.save!
# puts "generated physical book"

# physical_book25 = PhysicalBook.new(price: rand(8..14), available: "yes", book: book10, bookstore: bookstore2, condition: "New")
# physical_book25.save!
# puts "generated physical book"

# physical_book26 = PhysicalBook.new(price: rand(3..8), available: "yes", book: book10, bookstore: bookstore6, condition: "Used")
# physical_book26.save!
# puts "generated physical book"

# physical_book27 = PhysicalBook.new(price: rand(8..14), available: "yes", book: book11, bookstore: bookstore1, condition: "New")
# physical_book27.save!
# puts "generated physical book"

# physical_book28 = PhysicalBook.new(price: rand(3..8), available: "yes", book: book12, bookstore: bookstore2, condition: "Used")
# physical_book28.save!
# puts "generated physical book"

# physical_book29 = PhysicalBook.new(price: rand(8..14), available: "yes", book: book12, bookstore: bookstore3, condition: "New")
# physical_book29.save!
# puts "generated physical book"

# physical_book30 = PhysicalBook.new(price: rand(3..8), available: "yes", book: book13, bookstore: bookstore6, condition: "Used")
# physical_book30.save!
# puts "generated physical book"

# physical_book31 = PhysicalBook.new(price: rand(8..14), available: "yes", book: book13, bookstore: bookstore1, condition: "New")
# physical_book31.save!
# puts "generated physical book"

# physical_book32 = PhysicalBook.new(price: rand(3..8), available: "yes", book: book14, bookstore: bookstore4, condition: "Used")
# physical_book32.save!
# puts "generated physical book"

# physical_book33 = PhysicalBook.new(price: rand(8..14), available: "yes", book: book14, bookstore: bookstore3, condition: "New")
# physical_book33.save!
# puts "generated physical book"

# physical_book34 = PhysicalBook.new(price: rand(3..8), available: "yes", book: book14, bookstore: bookstore6, condition: "Used")
# physical_book34.save!
# puts "generated physical book"

# physical_book35 = PhysicalBook.new(price: rand(8..14), available: "yes", book: book15, bookstore: bookstore1, condition: "New")
# physical_book35.save!
# puts "generated physical book"

# physical_book36 = PhysicalBook.new(price: rand(3..8), available: "yes", book: book15, bookstore: bookstore4, condition: "Used")
# physical_book36.save!
# puts "generated physical book"

# physical_book37 = PhysicalBook.new(price: rand(8..14), available: "yes", book: book16, bookstore: bookstore4, condition: "New")
# physical_book37.save!
# puts "generated physical book"

# physical_book38 = PhysicalBook.new(price: rand(3..8), available: "yes", book: book16, bookstore: bookstore4, condition: "Used")
# physical_book38.save!
# puts "generated physical book"

# physical_book39 = PhysicalBook.new(price: rand(8..14), available: "yes", book: book17, bookstore: bookstore2, condition: "New")
# physical_book39.save!
# puts "generated physical book"

# physical_book40 = PhysicalBook.new(price: rand(3..8), available: "yes", book: book17, bookstore: bookstore1, condition: "Used")
# physical_book40.save!
# puts "generated physical book"

# physical_book41 = PhysicalBook.new(price: rand(8..14), available: "yes", book: book18, bookstore: bookstore3, condition: "New")
# physical_book41.save!
# puts "generated physical book"

# physical_book42 = PhysicalBook.new(price: rand(3..8), available: "yes", book: book18, bookstore: bookstore4, condition: "Used")
# physical_book42.save!
# puts "generated physical book"

# physical_book43 = PhysicalBook.new(price: rand(8..14), available: "yes", book: book19, bookstore: bookstore6, condition: "New")
# physical_book43.save!
# puts "generated physical book"

# physical_book44 = PhysicalBook.new(price: rand(3..8), available: "yes", book: book21, bookstore: bookstore6, condition: "Used")
# physical_book44.save!
# puts "generated physical book"

# physical_book45 = PhysicalBook.new(price: rand(8..14), available: "yes", book: book21, bookstore: bookstore5, condition: "New")
# physical_book45.save!
# puts "generated physical book"



# puts 'Creating 25 new physical books...'
# 25.times do
#   new_physical_book = PhysicalBook.new(
#     price: rand(8..14),
#     available: "yes",
#     book: total_books.sample,
#     bookstore: total_bookstores.sample,
#     condition: "New"
#   )
#   new_physical_book.save!
# end
# puts 'Finished!'

# puts 'Creating 25 used physical books...'
# 25.times do
#   used_physical_book = PhysicalBook.new(
#     price: rand(3..8),
#     available: "yes",
#     book: total_books.sample,
#     bookstore: total_bookstores.sample,
#     condition: "Used"
#   )
#   used_physical_book.save!
# end
# puts 'Finished!'




# end
# puts 'Finished!'

query = "lord"
# url = "https://www.goodreads.com/search?utf8=%E2%9C%93&q=#{query}&search_type=books"
url = "https://openlibrary.org/search?q=#{query}&mode=everything"

html_file = URI.open(url).read
html_doc = Nokogiri::HTML(html_file)

html_doc.search(".booktitle > .results").each do |element|

  book = Book.new
  book.title = element.text.strip # Title
  url2 = "https://openlibrary.org/#{element.attribute("href").value}"
  html_file = URI.open(url2).read
  html = Nokogiri::HTML(html_file)
  book.year = html.search(".first-published-date").attribute("title").text&.split.last # Year

  book.author = html.search(".edition-byline > a").first&.text # Author

  genres = ["Adventure", "Childrens", "Classic", "Crime", "Fantasy", "Fiction",
            "Horror","Non-fiction", "Science Fiction", "Graphic Novel", "Epic Novel", "Romance"]
  book.genre = genres.match(html.search(".clamp a").first&.children&.text) # Genre


  # unless html.search(".clamp a").children&.text == nil
  #   genre_match = (html.search(".clamp a").children&.text).upcase.match(/(Adventure|Childrens|Classic|Crime|FANTASY|Fiction|Horror|Non-fiction|Science Fiction|Graphic Novel|Epic Novel|Romance)/
  #   ) # Either a match or nil
  #   if genre_match != nil
  #     book.genre = genre_match
  #     p genre_match
  #   end
  # end

  link = html.search(".SRPCover > a > .cover").attribute("src").value # Image
  # p link

  # if link != ""
  #   book.photo.attach(io: URI.open("https:#{link}"), filename: "david.jpg", content_type: "image/jpg")
  # end

  unless link == ""
    book.photo.attach(io: URI.open("https:#{link}"), filename: "david.jpg", content_type: "image/jpg")
    book.save!
    puts book.title
    total_books << book
  end
  puts "------------"

end
